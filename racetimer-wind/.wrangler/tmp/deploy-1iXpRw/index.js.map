{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "/home/casper/Dokumenter/sejlrelateret/racetimer/racetimer-wind/.wrangler/tmp/deploy-1iXpRw",
  "sourcesContent": ["const UPSTREAM_URL = \"http://kblvejr.dk/clientraw.txt\";\n\nfunction corsHeaders(origin) {\n  return {\n    \"Access-Control-Allow-Origin\": origin || \"*\",\n    \"Access-Control-Allow-Methods\": \"GET, OPTIONS\",\n    \"Access-Control-Allow-Headers\": \"Content-Type\",\n    \"Access-Control-Max-Age\": \"86400\",\n  };\n}\n\nfunction parseClientRaw(text) {\n  if (typeof text !== \"string\") return null;\n  const parts = text.trim().split(/\\s+/);\n  if (parts.length < 4) return null;\n  const windSpeed = Number.parseFloat(parts[1]);\n  const windGust = Number.parseFloat(parts[2]);\n  const windDirDeg = Number.parseFloat(parts[3]);\n  if (!Number.isFinite(windSpeed) && !Number.isFinite(windGust) && !Number.isFinite(windDirDeg)) {\n    return null;\n  }\n  return { windSpeed, windGust, windDirDeg };\n}\n\nexport default {\n  async fetch(request) {\n    const origin = request.headers.get(\"Origin\") || \"*\";\n    const headers = corsHeaders(origin);\n\n    if (request.method === \"OPTIONS\") {\n      return new Response(null, { status: 204, headers });\n    }\n\n    if (request.method !== \"GET\") {\n      return new Response(\"Method Not Allowed\", { status: 405, headers });\n    }\n\n    const url = new URL(request.url);\n    if (url.pathname !== \"/wind\" && url.pathname !== \"/\") {\n      return new Response(\"Not Found\", { status: 404, headers });\n    }\n\n    const upstreamUrl = `${UPSTREAM_URL}?nocache=${Date.now()}`;\n\n    try {\n      const upstream = await fetch(upstreamUrl, {\n        headers: { \"User-Agent\": \"RaceTimerWind/1.0\" },\n        cf: { cacheTtl: 5, cacheEverything: false },\n      });\n\n      if (!upstream.ok) {\n        return new Response(JSON.stringify({ error: \"upstream_error\" }), {\n          status: 502,\n          headers: {\n            ...headers,\n            \"content-type\": \"application/json\",\n            \"cache-control\": \"no-store\",\n          },\n        });\n      }\n\n      const text = await upstream.text();\n      const parsed = parseClientRaw(text);\n      if (!parsed) {\n        return new Response(JSON.stringify({ error: \"parse_error\" }), {\n          status: 502,\n          headers: {\n            ...headers,\n            \"content-type\": \"application/json\",\n            \"cache-control\": \"no-store\",\n          },\n        });\n      }\n\n      const payload = {\n        ...parsed,\n        source: \"kblvejr.dk\",\n        updatedAt: new Date().toISOString(),\n      };\n\n      return new Response(JSON.stringify(payload), {\n        headers: {\n          ...headers,\n          \"content-type\": \"application/json\",\n          \"cache-control\": \"no-store\",\n        },\n      });\n    } catch (err) {\n      return new Response(JSON.stringify({ error: \"fetch_failed\" }), {\n        status: 502,\n        headers: {\n          ...headers,\n          \"content-type\": \"application/json\",\n          \"cache-control\": \"no-store\",\n        },\n      });\n    }\n  },\n};\n"],
  "mappings": "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",
  "names": []
}
