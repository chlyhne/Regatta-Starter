# AGENTS.md

Instructions for coding agents working in this repo.

## Product intent
- RaceTimer is a minimal, high-contrast race start tool for sailors.
- UI must stay readable one-handed under stress; keep copy short and buttons large.

## Tech constraints
- Static PWA: vanilla HTML/CSS/JS modules with no build step or framework.
- Keep dependencies minimal; Leaflet in `vendor/` is the only map library.
- Reuse helpers in `format.js`, `geo.js`, `velocity.js`, and `kalman.js` instead of re-implementing logic.
- Centralize plotting utilities in `core/plot.js` (do not duplicate plot helpers elsewhere).

## UX and style
- Black/white theme with strong contrast.
- Avoid decorative elements, extra text, or crowded layouts.
- Avoid small tap targets; prioritize legibility over density.
- Never use `text-transform: uppercase;` anywhere.
- Prefer structural fixes over ad-hoc overrides; rework the layout instead of patching around it.

## Data and storage
- Settings and saved lines live in `localStorage` via `state.js` and `settings.js`.
- If you change stored shapes, bump `SETTINGS_VERSION` and add migration logic.

## GPS behavior
- Race mode should use high-accuracy, high-frequency GPS.
- Setup and post-start should use lower-intensity GPS to save battery.

## PWA and offline
- If you add/rename assets, update `ASSETS` and bump `CACHE_NAME` in `sw.js`.
- Map tiles are networked; the app must still work without tiles once lines are set.

## Debug and QA
- Debug mode is optional and enabled via `?debug=true`.
- When asked to debug and a bug is found, add a new test that would catch that class of bug across the app, unless such a test already exists.

## Communication
- When presenting options, avoid repeating the same set of options in multiple lists.
- If two option lists are needed, use `1/2/3` for the first list and `a/b/c` for the next.
- Avoid bullet lists for options; prefer numbered lists whenever possible.

## Run locally
- Open `index.html` directly, or serve the folder with a static server (e.g., `python3 -m http.server`).

## Documentation (LaTeX)
- Docs live in `docs/` and are LaTeX-only (do not add `docs/*.md`).
- Entry point: `docs/master.tex` (includes `docs/preamble.tex` + content files).
- Content files: `docs/intro.tex`, `docs/tuning.tex`, `docs/kalman.tex`, `docs/appendix.tex`.
- Build: run `latexmk` from `docs/` (e.g. `latexmk -pdf -synctex=1 master.tex`).
- Tuning plots are generated by `scripts/plot_tuning.py` into `docs/plots/` (keep the script; we iterate on it).
- If you add/rename doc assets that should be available offline, update `ASSETS` and bump `CACHE_NAME` in `sw.js`.

### Documentation style (LaTeX)
- Prefer a **verbose, guided narrative**: add motivation and transitions so each step feels natural.
- After every `\\part{}`, `\\section{}`, or `\\subsection{}`, include a short lead-in paragraph describing what follows.
- Avoid bullet lists unless strictly necessary; prefer prose.
  - When a list is necessary, keep it short and explain the point in surrounding text.
- When introducing formulas, present the equations first and explain each symbol inline in the following text.
- Use `flalign` for displayed equations with a leading `\hspace{5em}` so they are not flush to the margin.
- Align around `=` with `&`, and include a right-aligned unit column using `&&` in every displayed equation.
- Wrap units in `\left[ \right]` in the right-aligned unit column.
- Add `\label{...}` to each displayed equation and reference it with `\eqref{...}` in the surrounding text.
